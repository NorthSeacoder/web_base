# 堆

## 掌握程度

-   能代码实现堆,堆排序并掌握堆的三种应用
    -   优先级队列
    -   Top K
    -   中位数

## 代码实现

-   实现一个小顶堆,大顶堆,优先级队列
-   实现堆排序
-   利用优先级队列合并 K 个有序数组
-   求一组动态数据集合的最大 Top K

## 概念

-   堆是一个完全二叉树
-   堆中的每个节点的值必须大于等于(或小于等于)其子树中每个节点的值

## 操作

### 往堆中插入一个元素

-   堆化:将不满足堆特性的数组调整到满足的过程
    -   顺着节点所在的路径,向上或向下,对比,然后交换
-   过程
    -   让新插入的节点与父节点比对大小
    -   如果不满足子节点小于等于父节点的大小关系,就互换两个节点
    -   重复这个过程

### 删除堆顶元素

-   过程
    -   将最后一个节点放到堆顶,然后堆化

## 堆排序

-   堆排序是一种原地的,时间复杂度为 O(nlogn)的排序算法

### 步骤

-   原地建堆
    -   思路一:将第一个元素放在数组下标 1 的位置,调用堆的插入操作,,将 2-n 依次插入
    -   ※思路二:
        -   将下标 n/2=>1 的数据进行堆化
        -   n/2+1=>n 是叶子节点,不需要堆化(完全二叉树)
        -   时间复杂度:O(n)(仅建堆操作)
-   排序(大顶堆)
    -   此时最大值在堆顶,将其与最后一个元素交换,即最大元素放在下标为 n 的位置
    -   将剩下 n-1 个元素堆化,然后其中的最大值与最后交换,即放在 n-1 的位置
    -   重复这个操作,知道堆中只剩下下标为 1 的一个元素
    -   时间复杂度:O(nlogn)

### 缺点

-   堆化时跳着访问数据,不利于 cpu 缓存
-   同样的数据,数据交换次数大于快速排序
-   建堆时会打乱原有顺序

## 应用

### 优先级队列

-   概念:按照优先级,优先级高的先出
-   具体应用
    -   合并有序小文件:将小文件中的字符串取出放入小顶堆,堆顶元素,即优先级队列队首元素即最小字符串,将其放入大文件中,并将其从堆中删除,然后再从小文件中取出洗衣歌字符串放入堆中
    -   高性能定时器:按照设定时间存储在小顶堆中,队首即最先执行的任务,用其时间点与当前时间相减获取间隔 T ,T s 之后第一个任务执行并删除堆顶元素,重新计算新的时间差值

### 求 topK

-   维护一个大小为 K 的小顶堆,从数组中取出数据插入队中,堆满后继续取数据与堆顶元素比较,比堆顶大,则删除堆顶元素,并将该元素插入堆中

### 求中位数

-   维护两个堆,一个大顶堆存储前半部分数据,剩下存储在小顶堆中,且小顶堆中的数据都大于大顶堆中的数据
-   总数为偶数时,大顶堆保留 n/2 个数据,奇数时 n/2+1
-   此时,大顶堆堆顶元素为中位数
-   新增数据时,小于等于大顶堆的堆顶元素,即插入大顶堆中,否则插入小顶堆中
-   若两个堆中数量不符合 50%,则多的那一方的堆顶元素挪到另一方
